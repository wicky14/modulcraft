<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ModulCraft â€” Daftar Kebutuhan Aplikasi</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARIABLES & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --cream:#F8F5F0; --warm-white:#FFFEF9; --ink:#1A1209; --ink-light:#4A3F2F; --ink-muted:#8A7A66;
  --accent:#C8622A; --accent-l:#F5E6DB; --accent-m:#E8976A;
  --accent:#C8622A; --accent-l:#F5E6DB; --accent-m:#E8976A;
  --gold:#C9A84C; --gold-l:#F7EFD8;
  --border:#E2D9CC; --border-l:#EEE8DF;
  --green:#3A7A5C; --green-l:#E6F2EC;
  --red:#C83A3A; --red-l:#FAEAEA;
  --sb:264px; --tb:52px; --pv:400px; --mb:64px;
  --sh-sm:0 1px 4px rgba(26,18,9,.07);
  --sh-md:0 4px 16px rgba(26,18,9,.10);
  --sh-lg:0 12px 32px rgba(26,18,9,.14);
  --r:10px; --rs:7px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden}
body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--ink);font-size:14px;line-height:1.6;display:flex;flex-direction:column;}

/* â•â• TOPBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.topbar{height:var(--tb);background:var(--ink);border-bottom:2.5px solid var(--accent);display:flex;align-items:center;justify-content:space-between;padding:0 14px;flex-shrink:0;gap:8px;z-index:300;position:relative;}
.tb-brand{font-family:'Playfair Display',serif;font-size:15px;color:#fff;white-space:nowrap;flex-shrink:0;display:flex;align-items:center;gap:8px;}
.tb-brand em{color:var(--accent-m);font-style:normal;}
.tb-menu-btn{display:none;background:transparent;border:1px solid rgba(255,255,255,.25);color:#fff;border-radius:6px;padding:6px 8px;cursor:pointer;align-items:center;justify-content:center;}
.tb-menu-btn svg{width:18px;height:18px;}
.tb-actions{display:flex;gap:6px;align-items:center;}

/* â•â• BUTTONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 13px;border-radius:var(--rs);font-family:'DM Sans',sans-serif;font-size:12.5px;font-weight:500;cursor:pointer;border:none;transition:all .15s ease;white-space:nowrap;text-decoration:none;position:relative;}
.btn svg{width:13px;height:13px;flex-shrink:0;}
.btn-primary{background:var(--accent);color:#fff;} .btn-primary:hover{background:#A84F20;transform:translateY(-1px);box-shadow:var(--sh-md);}
.btn-gold{background:var(--gold);color:#fff;} .btn-gold:hover{background:#A88A38;transform:translateY(-1px);box-shadow:var(--sh-md);}
.btn-ghost{background:transparent;color:rgba(255,255,255,.8);border:1px solid rgba(255,255,255,.22);} .btn-ghost:hover{background:rgba(255,255,255,.09);color:#fff;}
.btn-prev{background:rgba(255,255,255,.08);color:#fff;border:1px solid rgba(255,255,255,.25);} .btn-prev:hover,.btn-prev.on{background:var(--accent);border-color:var(--accent);}
.btn-outline{background:#fff;color:var(--ink);border:1.5px solid var(--border);} .btn-outline:hover{border-color:var(--accent);color:var(--accent);}
.btn-danger{background:var(--red-l);color:var(--red);border:1.5px solid #E8BFBF;} .btn-danger:hover{background:var(--red);color:#fff;}
.btn-blue{background:#EAF2FF;color:#2563EB;border:1.5px solid #C0D7FF;} .btn-blue:hover{background:#2563EB;color:#fff;}
.btn-sm{padding:5px 11px;font-size:12px;} .btn-xs{padding:3px 9px;font-size:11px;}

/* Export dropdown â€” desktop */
.export-wrap{position:relative;}
.export-menu{
  display:none;position:absolute;top:calc(100% + 6px);right:0;
  background:#fff;border:1.5px solid var(--border);border-radius:var(--r);
  box-shadow:var(--sh-lg);min-width:200px;z-index:9999;overflow:hidden;
}
.export-menu.open{display:block;}
.export-item{
  display:flex;align-items:center;gap:10px;padding:11px 14px;
  font-size:13px;font-weight:500;color:var(--ink);cursor:pointer;
  transition:background .12s;border:none;background:none;width:100%;text-align:left;font-family:'DM Sans',sans-serif;
}
.export-item:hover{background:var(--accent-l);}
.export-item svg{width:15px;height:15px;flex-shrink:0;color:var(--accent);}
.export-item .ei-sub{font-size:11px;color:var(--ink-muted);font-weight:400;display:block;margin-top:1px;}
.export-sep{height:1px;background:var(--border-l);margin:4px 0;}

/* Export bottom sheet â€” mobile only */
.export-sheet-overlay{
  display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);
  z-index:9990;backdrop-filter:blur(3px);
}
.export-sheet-overlay.open{display:block;}
.export-sheet{
  position:fixed;bottom:0;left:0;right:0;
  background:#fff;border-radius:18px 18px 0 0;
  z-index:9992;padding:0 0 env(safe-area-inset-bottom,12px);
  transform:translateY(100%);transition:transform .28s cubic-bezier(.32,1,.6,1);
  box-shadow:0 -8px 32px rgba(0,0,0,.15);
}
.export-sheet.open{transform:translateY(0);}
.export-sheet-handle{
  width:36px;height:4px;background:var(--border);border-radius:2px;
  margin:12px auto 4px;
}
.export-sheet-title{
  font-size:11px;font-weight:800;letter-spacing:.07em;text-transform:uppercase;
  color:var(--ink-muted);text-align:center;padding:6px 0 10px;
  border-bottom:1px solid var(--border-l);margin:0 14px;
}
.export-sheet .export-item{padding:14px 20px;}
.export-sheet .export-sep{margin:0 14px;}
.export-sheet-cancel{
  display:block;width:calc(100% - 28px);margin:10px 14px 6px;
  padding:12px;background:var(--cream);border:none;border-radius:var(--rs);
  font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;
  color:var(--ink-muted);cursor:pointer;transition:background .14s;
}
.export-sheet-cancel:hover{background:var(--border-l);}

/* â•â• APP LAYOUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app{display:flex;flex:1;overflow:hidden;position:relative;}

/* â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar{width:var(--sb);flex-shrink:0;background:var(--warm-white);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;transition:transform .28s ease;z-index:200;}
.sb-head{padding:12px 13px 10px;border-bottom:1px solid var(--border-l);flex-shrink:0;}
.sb-head-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.sb-title{font-size:10px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:var(--ink-muted);}
.sb-count{background:var(--accent-l);color:var(--accent);font-size:11px;font-weight:700;font-family:'DM Mono',monospace;padding:1px 8px;border-radius:20px;}
.sb-add{width:100%;padding:8px;border-radius:var(--rs);background:var(--accent);color:#fff;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;font-family:'DM Sans',sans-serif;font-size:12.5px;font-weight:500;transition:background .14s;}
.sb-add:hover{background:#A84F20;} .sb-add svg{width:13px;height:13px;}
.sb-list{flex:1;overflow-y:auto;padding:6px;}
.sb-list::-webkit-scrollbar{width:3px;} .sb-list::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}
.sb-item{border-radius:var(--rs);margin-bottom:3px;border:1.5px solid transparent;transition:all .13s;}
.sb-item:hover{background:var(--accent-l);border-color:#EBC9B3;} .sb-item.on{background:var(--accent-l);border-color:var(--accent);}
.sb-row{padding:8px 9px;display:flex;align-items:flex-start;gap:7px;}
.sb-n{font-family:'DM Mono',monospace;font-size:9px;font-weight:700;color:var(--ink-muted);min-width:16px;padding-top:2px;flex-shrink:0;}
.sb-item.on .sb-n{color:var(--accent);}
.sb-info{flex:1;min-width:0;cursor:pointer;}
.sb-name{font-size:12px;font-weight:600;color:var(--ink);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:1.4;}
.sb-item.on .sb-name{color:var(--accent);}
.sb-tag{font-size:9.5px;padding:1px 6px;border-radius:20px;font-weight:700;display:inline-block;margin-top:2px;}
.tw{background:var(--gold-l);color:#8A6A1A;} .tt{background:var(--green-l);color:var(--green);}
.sb-del{background:transparent;border:none;cursor:pointer;padding:2px 4px;color:var(--ink-muted);border-radius:4px;flex-shrink:0;transition:all .13s;opacity:0;display:flex;align-items:center;}
.sb-item:hover .sb-del{opacity:1;} .sb-del:hover{background:var(--red-l);color:var(--red);}
.sb-del svg{width:11px;height:11px;}
.sb-empty{padding:28px 14px;text-align:center;color:var(--ink-muted);font-size:12px;}
.sb-empty-icon{font-size:26px;margin-bottom:7px;opacity:.4;}
.sb-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:199;backdrop-filter:blur(2px);}
.sb-overlay.show{display:block;}

/* â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main{flex:1;overflow-y:auto;min-width:0;}
.main::-webkit-scrollbar{width:5px;} .main::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}
.main-inner{max-width:660px;margin:0 auto;padding:22px 20px 80px;}
.sec-hd{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--border);}
.sec-title{font-family:'Playfair Display',serif;font-size:18px;font-weight:700;color:var(--ink);}
.sec-title small{display:block;font-family:'DM Sans',sans-serif;font-size:11px;color:var(--ink-muted);font-weight:400;margin-top:1px;}
.step-badge{font-size:10px;font-weight:800;letter-spacing:.07em;text-transform:uppercase;color:var(--ink-muted);background:var(--border-l);padding:3px 9px;border-radius:20px;flex-shrink:0;margin-top:3px;}
.card{background:var(--warm-white);border:1px solid var(--border);border-radius:var(--r);padding:18px 20px;margin-bottom:16px;box-shadow:var(--sh-sm);}
.fr{display:grid;grid-template-columns:1fr 1fr;gap:13px;margin-bottom:13px;}
.fr.full{grid-template-columns:1fr;} .fr.mb0{margin-bottom:0;}
.fg{display:flex;flex-direction:column;gap:4px;}
.fl{font-size:11px;font-weight:700;letter-spacing:.045em;text-transform:uppercase;color:var(--ink-light);}
.fl .req{color:var(--accent);}
.fh{font-size:11px;color:var(--ink-muted);}
input[type="text"],textarea,select{font-family:'DM Sans',sans-serif;font-size:13.5px;color:var(--ink);background:#fff;border:1.5px solid var(--border);border-radius:var(--rs);padding:8px 12px;transition:border-color .14s,box-shadow .14s;width:100%;resize:vertical;outline:none;}
input::placeholder,textarea::placeholder{color:#C5BAB0;}
input:focus,textarea:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(200,98,42,.10);}
textarea{min-height:72px;line-height:1.6;}
select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%238A7A66' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 11px center;padding-right:33px;}
.pw{border-color:#D4A757!important;background:#FFFDF5!important;}
.pt{border-color:#7CB8A2!important;background:#F5FDFB!important;}

/* â•â• IMAGE UPLOAD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.img-drop{border:2px dashed var(--border);border-radius:var(--r);padding:16px;text-align:center;cursor:pointer;transition:all .15s;background:#fff;position:relative;}
.img-drop:hover,.img-drop.over{border-color:var(--accent);background:var(--accent-l);}
.img-drop input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.img-drop-icon{font-size:22px;margin-bottom:4px;opacity:.5;}
.img-drop-txt{font-size:12px;color:var(--ink-muted);}
.img-drop-txt strong{color:var(--accent);}
.img-drop-txt small{display:block;font-size:10.5px;margin-top:2px;}
.img-grid{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;}
.img-th{position:relative;width:68px;height:68px;border-radius:var(--rs);overflow:hidden;border:1.5px solid var(--border);background:#f0f0f0;flex-shrink:0;}
.img-th img{width:100%;height:100%;object-fit:cover;display:block;}
.img-th-del{position:absolute;top:2px;right:2px;background:rgba(0,0,0,.65);color:#fff;border:none;border-radius:50%;width:18px;height:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;opacity:0;transition:opacity .14s;}
.img-th:hover .img-th-del{opacity:1;}
.img-cap{font-size:10px;text-align:center;color:var(--ink-muted);margin-top:2px;width:68px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.edit-ban{background:var(--gold-l);border:1.5px solid var(--gold);border-radius:var(--rs);padding:9px 13px;display:flex;align-items:center;gap:8px;margin-bottom:13px;font-size:12.5px;font-weight:500;color:var(--ink-light);}
.edit-ban svg{color:var(--gold);flex-shrink:0;width:14px;height:14px;}
.form-actions{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;}

/* â•â• PREVIEW PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pv-panel{width:0;flex-shrink:0;background:#E0DDD8;border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;transition:width .28s ease;}
.pv-panel.open{width:var(--pv);}
.pv-head{padding:9px 12px;background:var(--warm-white);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;width:var(--pv);}
.pv-title{font-size:10.5px;font-weight:800;letter-spacing:.06em;text-transform:uppercase;color:var(--ink-muted);}
.pv-scroll{flex:1;min-height:0;width:var(--pv);overflow-y:scroll;overflow-x:hidden;padding:12px;display:flex;flex-direction:column;align-items:center;}
.pv-scroll::-webkit-scrollbar{width:5px;}
.pv-scroll::-webkit-scrollbar-track{background:#D4CFC9;}
.pv-scroll::-webkit-scrollbar-thumb{background:#A89E94;border-radius:3px;}
.pv-scroll::-webkit-scrollbar-thumb:hover{background:#7A6E65;}
.pv-page{width:100%;background:#fff;box-shadow:var(--sh-lg);border-radius:3px;}

/* â•â• TOAST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toasts{position:fixed;bottom:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:7px;}
.toast{background:var(--ink);color:#fff;padding:10px 16px;border-radius:var(--rs);font-size:12.5px;font-weight:500;box-shadow:var(--sh-lg);display:flex;align-items:center;gap:8px;animation:tIn .2s ease,tOut .3s ease 2.6s forwards;max-width:280px;}
.toast.ok{border-left:3px solid #5EC989;} .toast.err{border-left:3px solid var(--accent);}
@keyframes tIn{from{transform:translateX(55px);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes tOut{to{opacity:0;transform:translateX(12px)}}

/* â•â• MOBILE BOTTOM NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mob-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--warm-white);border-top:1px solid var(--border);z-index:350;padding:8px 4px 12px;gap:4px;justify-content:space-around;box-shadow:0 -4px 10px rgba(0,0,0,.05);}
.mnb{display:flex;flex-direction:column;align-items:center;gap:3px;background:none;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:10px;font-weight:600;color:var(--ink-muted);padding:0 8px;flex:1;}
.mnb svg{width:20px;height:20px;}
.mnb.active{color:var(--accent);}

/* â•â• RESPONSIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:900px){.pv-panel.open{width:320px;}}
@media(max-width:768px){
  .sidebar{position:fixed;left:0;top:var(--tb);height:calc(100% - var(--tb));transform:translateX(-100%);z-index:250;box-shadow:var(--sh-lg);}
  .sidebar.open{transform:translateX(0);}
  .pv-panel{display:none;}
  .pv-panel.mob-modal{display:flex;position:fixed;inset:0;top:var(--tb);bottom:var(--mb);width:100%!important;z-index:300;background:#E0DDD8;overflow:visible;height:calc(100% - var(--tb) - var(--mb));}
  .pv-panel.mob-modal .pv-scroll{width:100%;overflow-y:scroll;min-height:0;}
  .pv-panel.mob-modal .pv-head{width:100%;}
  .mob-nav{display:flex;}
  .tb-menu-btn{display:flex;}
  .tb-actions .btn-prev,.tb-actions .btn-ghost{display:none;}
  .tb-brand{font-size:14px;}
  .main-inner{padding:16px 14px 80px;}
  .fr{grid-template-columns:1fr;}
  .sec-hd{flex-wrap:wrap;gap:6px;}
  .export-menu{right:auto;left:0;}
}
@media(max-width:480px){
  .topbar{padding:0 10px;}
  .tb-brand em{display:none;}
  .btn-gold span{display:none;}
  .card{padding:14px 15px;}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PDF DOCUMENT STYLES
   Used in preview .pv-page AND print window
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pdoc{padding:28px 32px 24px;background:#fff;font-family:'DM Sans',sans-serif;font-size:10px;color:#1A1209;line-height:1.52;}
.pdoc-hdr{display:flex;justify-content:space-between;align-items:flex-start;padding-bottom:10px;margin-bottom:12px;border-bottom:2.5px solid #C8622A;}
.pdoc-hdr-accent{font-size:7px;font-weight:800;letter-spacing:.1em;text-transform:uppercase;color:#C8622A;margin-bottom:3px;}
.pdoc-hdr-title{font-family:'Playfair Display',serif;font-size:16px;font-weight:700;color:#1A1209;line-height:1.2;}
.pdoc-hdr-r{text-align:right;}
.pdoc-hdr-app{font-size:11px;font-weight:700;color:#1A1209;margin-bottom:2px;}
.pdoc-hdr-meta{font-size:7.5px;color:#8A7A66;line-height:1.6;}
.pdoc-info{display:grid;grid-template-columns:1fr 1fr;background:#FAF7F2;border:1px solid #E2D9CC;border-radius:5px;overflow:hidden;margin-bottom:12px;}
.pdoc-ic{padding:7px 10px;border-right:1px solid #E2D9CC;} .pdoc-ic:last-child{border-right:none;}
.pdoc-il{font-size:6.5px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:#8A7A66;margin-bottom:2px;}
.pdoc-iv{font-size:9.5px;font-weight:600;color:#1A1209;}
.pdoc-glbl{font-size:7px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;padding:4px 9px;border-radius:4px;display:inline-flex;align-items:center;gap:4px;margin-bottom:7px;margin-top:4px;}
.gl-w{background:#F7EFD8;color:#8A6A1A;} .gl-t{background:#E6F2EC;color:#3A7A5C;}
.pdoc-mod{border:1px solid #DDD6CE;border-radius:6px;margin-bottom:9px;overflow:hidden;}
.pdoc-mhd{background:#F8F5F0;padding:7px 10px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #DDD6CE;}
.pdoc-mhd-l{display:flex;align-items:center;}
.pdoc-mnum{font-family:'DM Mono',monospace;font-size:7px;font-weight:700;color:#C8622A;background:#F5E6DB;padding:1px 5px;border-radius:20px;margin-right:6px;flex-shrink:0;}
.pdoc-mname{font-size:9.5px;font-weight:700;color:#1A1209;}
.pdoc-mpri{font-size:7px;font-weight:700;padding:2px 6px;border-radius:20px;flex-shrink:0;}
.pm-w{background:#F7EFD8;color:#8A6A1A;} .pm-t{background:#E6F2EC;color:#3A7A5C;}
.pdoc-mbody{padding:8px 10px;}
.pdoc-f{margin-bottom:7px;} .pdoc-f:last-child{margin-bottom:0;}
.pdoc-fl{font-size:6.5px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:#8A7A66;margin-bottom:3px;padding-bottom:2px;border-bottom:1px solid #EEE8DF;}
.pdoc-fv{font-size:9px;color:#2A2015;line-height:1.6;white-space:pre-wrap;word-break:break-word;}
.pdoc-2c{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.pdoc-imgs{display:flex;flex-wrap:wrap;gap:7px;margin-top:5px;}
.pdoc-img-wrap{display:flex;flex-direction:column;align-items:center;gap:2px;}
.pdoc-img-wrap img{border-radius:4px;border:1px solid #DDD6CE;object-fit:cover;display:block;}
.pdoc-img-cap{font-size:6.5px;color:#8A7A66;text-align:center;max-width:90px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.pdoc-notes{background:#FFF8F5;border:1px solid #F0D5C5;border-radius:5px;padding:7px 10px;margin-top:9px;}
.pdoc-nl{font-size:6.5px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:#C8622A;margin-bottom:3px;}
.pdoc-nv{font-size:9px;color:#2A2015;line-height:1.6;white-space:pre-wrap;}
.pdoc-ftr{margin-top:10px;padding-top:6px;border-top:1px solid #E2D9CC;display:flex;justify-content:space-between;font-size:7px;color:#8A7A66;}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="tb-brand">
    <button class="tb-menu-btn" id="menu-btn" onclick="toggleSidebar()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    Modul<em>Craft</em>
  </div>
  <div class="tb-actions">
    <button class="btn btn-prev" id="prev-btn" onclick="togglePreview()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
      <span>Preview</span>
    </button>
    <button class="btn btn-ghost btn-sm" onclick="confirmReset()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-4.26"/></svg>
      Reset
    </button>
    <!-- Export dropdown -->
    <div class="export-wrap" id="export-wrap">
      <button class="btn btn-gold" onclick="toggleExportMenu()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        <span>Export</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:10px;height:10px"><polyline points="6 9 12 15 18 9"/></svg>
      </button>
      <div class="export-menu" id="export-menu">
        <button class="export-item" onclick="doPrint()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
          <div><span>Print / PDF</span><span class="ei-sub">Simpan sebagai PDF via printer</span></div>
        </button>
        <div class="export-sep"></div>
        <button class="export-item" onclick="exportWord()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
          <div><span>Export Word (.doc)</span><span class="ei-sub">Buka di Microsoft Word</span></div>
        </button>
        <button class="export-item" onclick="exportHTML()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
          <div><span>Export HTML</span><span class="ei-sub">File dokumen mandiri</span></div>
        </button>
      </div>
    </div>
  </div>
</div>

<div class="sb-overlay" id="sb-overlay" onclick="closeSidebar()"></div>

<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="sb-head">
      <div class="sb-head-row">
        <span class="sb-title">Daftar Modul</span>
        <span class="sb-count" id="sb-count">0</span>
      </div>
      <button class="sb-add" onclick="newModule()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Tambah Modul Baru
      </button>
    </div>
    <div class="sb-list" id="sb-list"></div>
  </aside>

  <!-- MAIN -->
  <main class="main" id="main">
    <div class="main-inner">
      <div class="sec-hd">
        <div class="sec-title">Informasi Proyek<small>Data umum aplikasi yang akan dibuat</small></div>
        <span class="step-badge">Step 1</span>
      </div>
      <div class="card">
        <div class="fr">
          <div class="fg">
            <label class="fl">Nama Aplikasi <span class="req">*</span></label>
            <input type="text" id="app-name" placeholder="cth: Sistem Informasi Pesantren" oninput="saveProj();schedPreview()"/>
          </div>
          <div class="fg">
            <label class="fl">Target Pengguna <span class="req">*</span></label>
            <input type="text" id="target-user" placeholder="cth: Admin, Wali Santri, Ustadz" oninput="saveProj();schedPreview()"/>
          </div>
        </div>
        <div class="fr full mb0">
          <div class="fg">
            <label class="fl">Catatan untuk Programmer</label>
            <textarea id="extra-notes" placeholder="cth: Tema hijau pesantren, integrasi printer thermal" style="min-height:54px" oninput="saveProj();schedPreview()"></textarea>
          </div>
        </div>
      </div>

      <div class="sec-hd" style="margin-top:4px">
        <div class="sec-title" id="form-title">Tambah Modul Baru<small>Isi detail kebutuhan setiap modul</small></div>
        <span class="step-badge">Step 2</span>
      </div>
      <div id="edit-ban" class="edit-ban" style="display:none">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        <span>Mode <strong>Edit</strong> â€” <span id="edit-name" style="color:var(--accent)"></span></span>
      </div>
      <div class="card" id="mod-form">
        <div class="fr">
          <div class="fg">
            <label class="fl">Nama Modul <span class="req">*</span></label>
            <input type="text" id="mod-name" placeholder="cth: Modul Pengisian Data Santri"/>
          </div>
          <div class="fg">
            <label class="fl">Prioritas</label>
            <select id="mod-pri" onchange="updatePri()">
              <option value="Wajib Ada">â­ Wajib Ada</option>
              <option value="Tambahan Saja">ğŸ’¡ Tambahan Saja</option>
            </select>
          </div>
        </div>
        <div class="fr full">
          <div class="fg">
            <label class="fl">Deskripsi Fitur</label>
            <textarea id="mod-desc" placeholder="Jelaskan kegunaan fitur ini bagi pengguna."></textarea>
          </div>
        </div>
        <div class="fr full">
          <div class="fg">
            <label class="fl">Input Data <span class="fh" style="text-transform:none;font-weight:400;font-size:11px;">(apa yang diisi user?)</span></label>
            <textarea id="mod-input" placeholder="- Nama lengkap&#10;- Tanggal lahir&#10;- Foto 3x4"></textarea>
          </div>
        </div>
        <div class="fr full">
          <div class="fg">
            <label class="fl">Proses / Logika Program</label>
            <textarea id="mod-process" placeholder="- Sistem otomatis buat NIS unik&#10;- Validasi NIK tidak boleh duplikat"></textarea>
          </div>
        </div>
        <div class="fr full">
          <div class="fg">
            <label class="fl">Output / Hasil Akhir</label>
            <textarea id="mod-output" placeholder="- Data Santri PDF bisa dicetak&#10;- Data tersimpan di database"></textarea>
          </div>
        </div>
        <div class="fr full mb0">
          <div class="fg">
            <label class="fl">Gambar Referensi <span class="fh" style="text-transform:none;font-weight:400;font-size:11px;">(opsional Â· max 5 Â· tampil di dokumen)</span></label>
            <div class="img-drop" id="drop-zone" ondragover="event.preventDefault();this.classList.add('over')" ondragleave="this.classList.remove('over')" ondrop="onDrop(event)">
              <input type="file" id="img-in" accept="image/*" multiple onchange="onFiles(this.files)"/>
              <div class="img-drop-icon">ğŸ–¼ï¸</div>
              <div class="img-drop-txt"><strong>Klik atau drag & drop</strong><small>JPG, PNG, GIF Â· Maks 5 gambar</small></div>
            </div>
            <div class="img-grid" id="img-grid"></div>
          </div>
        </div>
        <div class="form-actions">
          <button class="btn btn-primary" onclick="saveMod()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
            Simpan Modul
          </button>
          <button class="btn btn-outline" id="cancel-btn" onclick="cancelEdit()" style="display:none">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            Batal Edit
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- PREVIEW PANEL -->
  <div class="pv-panel" id="pv-panel">
    <div class="pv-head">
      <span class="pv-title">ğŸ“„ Live Preview</span>
      <div style="display:flex;gap:6px">
        <button class="btn btn-gold btn-xs" onclick="doPrint()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:11px;height:11px"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
          Print
        </button>
        <button class="btn btn-outline btn-xs" onclick="closePreview()">âœ•</button>
      </div>
    </div>
    <div class="pv-scroll" id="pv-scroll"></div>
  </div>
</div>

<!-- MOBILE NAV -->
<div class="mob-nav" id="mob-nav">
  <button class="mnb" id="mnav-modules" onclick="mobModules()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="3"/></svg>
    Modul
  </button>
  <button class="mnb active" id="mnav-form" onclick="mobForm()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
    Isi Form
  </button>
  <button class="mnb" id="mnav-preview" onclick="mobPreview()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
    Preview
  </button>
  <button class="mnb" onclick="toggleExportMenu()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
    Export
  </button>
</div>

<!-- MOBILE EXPORT BOTTOM SHEET -->
<div class="export-sheet-overlay" id="sheet-overlay" onclick="closeExportSheet()"></div>
<div class="export-sheet" id="export-sheet">
  <div class="export-sheet-handle"></div>
  <div class="export-sheet-title">Pilih Format Export</div>
  <button class="export-item" onclick="doPrint();closeExportSheet()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
    <div><span>Print / PDF</span><span class="ei-sub">Simpan sebagai PDF via printer</span></div>
  </button>
  <div class="export-sep"></div>
  <button class="export-item" onclick="exportWord();closeExportSheet()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
    <div><span>Export Word (.doc)</span><span class="ei-sub">Buka di Microsoft Word</span></div>
  </button>
  <button class="export-item" onclick="exportHTML();closeExportSheet()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
    <div><span>Export HTML</span><span class="ei-sub">File dokumen mandiri</span></div>
  </button>
  <button class="export-sheet-cancel" onclick="closeExportSheet()">Batal</button>
</div>

<div class="toasts" id="toasts"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SK='mc_v5';
let mods=[],editId=null,imgs=[],pvOpen=false,pvTimer=null;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const $=id=>document.getElementById(id);
const val=id=>$(id).value;
const setv=(id,v)=>$(id).value=v;
function esc(s){if(!s)return '';return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STORAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveProj(){
  try{localStorage.setItem(SK,JSON.stringify({app:val('app-name'),usr:val('target-user'),notes:val('extra-notes'),mods}));}catch(e){}
}
function loadProj(){
  try{
    const d=JSON.parse(localStorage.getItem(SK));
    if(!d){loadExample();return;}
    setv('app-name',d.app||'');setv('target-user',d.usr||'');setv('extra-notes',d.notes||'');
    mods=d.mods||[];
  }catch(e){loadExample();}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CRUD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveMod(){
  const name=val('mod-name').trim();
  if(!name){toast('Nama modul wajib diisi!','err');return;}
  const m={id:editId||Date.now().toString(),name,pri:val('mod-pri'),
    desc:val('mod-desc').trim(),inp:val('mod-input').trim(),
    proc:val('mod-process').trim(),out:val('mod-output').trim(),
    imgs:[...imgs]};
  if(editId){const i=mods.findIndex(x=>x.id===editId);if(i>-1)mods[i]=m;toast('Modul diperbarui âœ“','ok');}
  else{mods.push(m);toast('Modul disimpan âœ“','ok');}
  saveProj();clearForm();renderSb();schedPreview();
}
function editMod(id){
  const m=mods.find(x=>x.id===id);if(!m)return;
  editId=id;
  setv('mod-name',m.name);setv('mod-pri',m.pri);
  setv('mod-desc',m.desc);setv('mod-input',m.inp);
  setv('mod-process',m.proc);setv('mod-output',m.out);
  imgs=[...(m.imgs||[])];renderImgGrid();updatePri();
  $('cancel-btn').style.display='flex';
  $('edit-ban').style.display='flex';
  $('edit-name').textContent=m.name;
  $('form-title').innerHTML='Edit Modul<small>Perbarui data modul yang dipilih</small>';
  renderSb();
  $('mod-form').scrollIntoView({behavior:'smooth',block:'start'});
  closeSidebar();
}
function delMod(id){
  if(!confirm('Hapus modul ini?'))return;
  mods=mods.filter(x=>x.id!==id);
  if(editId===id){editId=null;clearForm();}
  saveProj();renderSb();schedPreview();
  toast('Modul dihapus.','err');
}
function cancelEdit(){
  editId=null;clearForm();
  $('cancel-btn').style.display='none';
  $('edit-ban').style.display='none';
  $('form-title').innerHTML='Tambah Modul Baru<small>Isi detail kebutuhan setiap modul</small>';
  renderSb();
}
function newModule(){
  if(editId)cancelEdit();
  closeSidebar();
  setTimeout(()=>$('mod-name').focus(),120);
}
function clearForm(){
  ['mod-name','mod-desc','mod-input','mod-process','mod-output'].forEach(id=>setv(id,''));
  setv('mod-pri','Wajib Ada');imgs=[];renderImgGrid();updatePri();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderSb(){
  const list=$('sb-list');
  $('sb-count').textContent=mods.length;
  if(!mods.length){list.innerHTML=`<div class="sb-empty"><div class="sb-empty-icon">ğŸ“‹</div><p>Belum ada modul.<br>Klik tombol di atas.</p></div>`;return;}
  list.innerHTML=mods.map((m,i)=>{
    const tc=m.pri==='Wajib Ada'?'tw':'tt';
    const tt=m.pri==='Wajib Ada'?'â­ Wajib':'ğŸ’¡ Tambahan';
    const imgB=m.imgs?.length?` <span style="opacity:.5;font-size:9px">ğŸ–¼${m.imgs.length}</span>`:'';
    return `<div class="sb-item${editId===m.id?' on':''}" id="si-${m.id}">
      <div class="sb-row">
        <span class="sb-n">${String(i+1).padStart(2,'0')}</span>
        <div class="sb-info" onclick="editMod('${m.id}')">
          <div class="sb-name">${esc(m.name)}${imgB}</div>
          <span class="sb-tag ${tc}">${tt}</span>
        </div>
        <button class="sb-del" onclick="delMod('${m.id}')" title="Hapus">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M9 6V4h6v2"/></svg>
        </button>
      </div>
    </div>`;
  }).join('');
}
function toggleSidebar(){$('sidebar').classList.contains('open')?closeSidebar():openSidebar();}
function openSidebar(){$('sidebar').classList.add('open');$('sb-overlay').classList.add('show');}
function closeSidebar(){$('sidebar').classList.remove('open');$('sb-overlay').classList.remove('show');}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   IMAGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function onFiles(files){
  const rem=5-imgs.length;
  if(rem<=0){toast('Maks 5 gambar','err');return;}
  Array.from(files).slice(0,rem).forEach(f=>{
    const r=new FileReader();
    r.onload=e=>{imgs.push({d:e.target.result,n:f.name});renderImgGrid();};
    r.readAsDataURL(f);
  });
  $('img-in').value='';
}
function onDrop(e){e.preventDefault();$('drop-zone').classList.remove('over');onFiles(e.dataTransfer.files);}
function rmImg(i){imgs.splice(i,1);renderImgGrid();}
function renderImgGrid(){
  $('img-grid').innerHTML=imgs.map((img,i)=>`
    <div><div class="img-th">
      <img src="${img.d}" alt="${esc(img.n)}"/>
      <button class="img-th-del" onclick="rmImg(${i})">âœ•</button>
    </div>
    <div class="img-cap">${esc(img.n)}</div></div>`).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOCUMENT CONTENT BUILDER
   Returns HTML string â€” same for preview,
   print, word export, and html export
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildDoc(){
  const app=val('app-name')||'Aplikasi';
  const usr=val('target-user')||'â€”';
  const notes=val('extra-notes');
  const now=new Date().toLocaleDateString('id-ID',{day:'2-digit',month:'long',year:'numeric'});
  const wM=mods.filter(m=>m.pri==='Wajib Ada');
  const tM=mods.filter(m=>m.pri==='Tambahan Saja');

  function renderImgs(imgArr){
    if(!imgArr?.length)return '';
    const sz=imgArr.length===1?100:imgArr.length===2?85:imgArr.length<=3?70:58;
    return `<div class="pdoc-imgs">${imgArr.map(img=>`
      <div class="pdoc-img-wrap">
        <img src="${img.d}" style="width:${sz}px;height:${sz}px"/>
        <div class="pdoc-img-cap">${esc(img.n)}</div>
      </div>`).join('')}</div>`;
  }

  function renderMods(arr,start){
    return arr.map((m,i)=>`
      <div class="pdoc-mod">
        <div class="pdoc-mhd">
          <div class="pdoc-mhd-l">
            <span class="pdoc-mnum">${String(start+i+1).padStart(2,'0')}</span>
            <span class="pdoc-mname">${esc(m.name)}</span>
          </div>
          <span class="pdoc-mpri ${m.pri==='Wajib Ada'?'pm-w':'pm-t'}">${m.pri==='Wajib Ada'?'â­ Wajib Ada':'ğŸ’¡ Tambahan'}</span>
        </div>
        <div class="pdoc-mbody">
          ${m.desc?`<div class="pdoc-f"><div class="pdoc-fl">Deskripsi Fitur</div><div class="pdoc-fv">${esc(m.desc)}</div></div>`:''}
          ${(m.inp||m.proc)?`<div class="pdoc-2c">
            ${m.inp?`<div class="pdoc-f"><div class="pdoc-fl">Input Data</div><div class="pdoc-fv">${esc(m.inp)}</div></div>`:'<div></div>'}
            ${m.proc?`<div class="pdoc-f"><div class="pdoc-fl">Proses / Logika</div><div class="pdoc-fv">${esc(m.proc)}</div></div>`:'<div></div>'}
          </div>`:''}
          ${m.out?`<div class="pdoc-f"><div class="pdoc-fl">Output / Hasil Akhir</div><div class="pdoc-fv">${esc(m.out)}</div></div>`:''}
          ${m.imgs?.length?`<div class="pdoc-f"><div class="pdoc-fl">Gambar Referensi</div>${renderImgs(m.imgs)}</div>`:''}
        </div>
      </div>`).join('');
  }

  return `<div class="pdoc">
    <div class="pdoc-hdr">
      <div>
        <div class="pdoc-hdr-accent">Dokumentasi Teknis</div>
        <div class="pdoc-hdr-title">Daftar Kebutuhan<br>Modul Aplikasi</div>
      </div>
      <div class="pdoc-hdr-r">
        <div class="pdoc-hdr-app">${esc(app)}</div>
        <div class="pdoc-hdr-meta">Dicetak: ${now}<br>${mods.length} Modul Total</div>
      </div>
    </div>
    <div class="pdoc-info">
      <div class="pdoc-ic"><div class="pdoc-il">Nama Aplikasi</div><div class="pdoc-iv">${esc(app)}</div></div>
      <div class="pdoc-ic"><div class="pdoc-il">Target Pengguna</div><div class="pdoc-iv">${esc(usr)}</div></div>
    </div>
    ${wM.length?`<div class="pdoc-glbl gl-w">â­ Modul Wajib Ada (${wM.length})</div>${renderMods(wM,0)}`:''}
    ${tM.length?`<div class="pdoc-glbl gl-t" style="margin-top:6px">ğŸ’¡ Modul Tambahan (${tM.length})</div>${renderMods(tM,wM.length)}`:''}
    ${notes?`<div class="pdoc-notes"><div class="pdoc-nl">ğŸ“Œ Catatan Tambahan untuk Programmer</div><div class="pdoc-nv">${esc(notes)}</div></div>`:''}
    <div class="pdoc-ftr"><span>ModulCraft Â· ${esc(app)}</span><span>${now}</span></div>
  </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PREVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function togglePreview(){pvOpen?closePreview():openPreview();}
function openPreview(){
  pvOpen=true;
  $('pv-panel').classList.add('open');
  $('prev-btn').classList.add('on');
  renderPreview();
}
function closePreview(){
  pvOpen=false;
  $('pv-panel').classList.remove('open','mob-modal');
  $('prev-btn').classList.remove('on');
  if(window.innerWidth<=768)setMobActive('mnav-form');
}
function renderPreview(){
  const s=$('pv-scroll');
  s.innerHTML=`<div class="pv-page">${buildDoc()}</div>`;
}
function schedPreview(){
  if(!pvOpen)return;
  clearTimeout(pvTimer);
  pvTimer=setTimeout(renderPreview,350);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPORT MENU (desktop dropdown + mobile sheet)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleExportMenu(){
  if(window.innerWidth<=768){
    openExportSheet();
  } else {
    $('export-menu').classList.toggle('open');
  }
}
function openExportSheet(){
  $('export-sheet').classList.add('open');
  $('sheet-overlay').classList.add('open');
}
function closeExportSheet(){
  $('export-sheet').classList.remove('open');
  $('sheet-overlay').classList.remove('open');
}
// close desktop menu when clicking outside
document.addEventListener('click',e=>{
  if(!$('export-wrap')?.contains(e.target))$('export-menu')?.classList.remove('open');
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRINT / PDF
   Opens a new window with full doc HTML,
   triggers print dialog, user can "Save as PDF"
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function doPrint(){
  if(!mods.length){toast('Belum ada modul!','err');return;}
  $('export-menu').classList.remove('open');
  const app=val('app-name')||'Dokumen';

  // Collect all CSS from main page that relates to pdoc styles
  const docStyles = Array.from(document.styleSheets)
    .flatMap(ss=>{try{return Array.from(ss.cssRules).map(r=>r.cssText);}catch(e){return [];}})
    .join('\n');

  const html=`<!DOCTYPE html>
  <html lang="id">
  <head>
  <meta charset="UTF-8">
  <title>${esc(app)} â€” Kebutuhan Modul</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
  ${docStyles}
  *{box-sizing:border-box;margin:0;padding:0;}
  
  /* TAMBAHKAN BARIS INI UNTUK MENCEGAH HALAMAN TERPOTONG */
  html, body { height: auto !important; overflow: visible !important; }
  
  body{background:#fff;margin:0;padding:0;}
  .pdoc{padding:20mm 18mm 18mm;}
  .pdoc-mod{page-break-inside:avoid;break-inside:avoid;}
  @page{size:A4 portrait;margin:0;}
  @media print{
    body{-webkit-print-color-adjust:exact;print-color-adjust:exact;}
    .pdoc-mod{page-break-inside:avoid;}
  }
  </style>
  </head>
  <body>${buildDoc()}</body>
  </html>`;

  const pw=window.open('','_blank','width=900,height=700');
  pw.document.open();
  pw.document.write(html);
  pw.document.close();
  // Wait for fonts/images to load then print
  pw.onload=()=>{
    setTimeout(()=>{pw.focus();pw.print();},600);
  };
  toast('Dialog print terbuka â€” pilih "Save as PDF"','ok');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPORT WORD (.doc)
   Uses mhtml trick that Word can open
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function exportWord(){
  if(!mods.length){toast('Belum ada modul!','err');return;}
  $('export-menu').classList.remove('open');
  const app=val('app-name')||'Dokumen';

  const wordStyles=`
    body{font-family:'DM Sans',Calibri,sans-serif;font-size:10pt;color:#1A1209;margin:2cm;}
    .pdoc{width:100%;}
    .pdoc-hdr{border-bottom:2pt solid #C8622A;padding-bottom:8pt;margin-bottom:10pt;display:table;width:100%;}
    .pdoc-hdr>div:first-child{display:table-cell;vertical-align:bottom;}
    .pdoc-hdr-r{display:table-cell;text-align:right;vertical-align:bottom;}
    .pdoc-hdr-accent{font-size:7pt;font-weight:bold;letter-spacing:1px;text-transform:uppercase;color:#C8622A;margin-bottom:2pt;}
    .pdoc-hdr-title{font-family:'Playfair Display','Times New Roman',serif;font-size:18pt;font-weight:700;color:#1A1209;line-height:1.2;}
    .pdoc-hdr-app{font-size:11pt;font-weight:bold;color:#1A1209;}
    .pdoc-hdr-meta{font-size:8pt;color:#8A7A66;}
    .pdoc-info{border:1pt solid #E2D9CC;background:#FAF7F2;margin-bottom:10pt;width:100%;border-collapse:collapse;}
    .pdoc-ic{padding:6pt 8pt;border-right:1pt solid #E2D9CC;}
    .pdoc-il{font-size:7pt;font-weight:bold;text-transform:uppercase;color:#8A7A66;letter-spacing:.5px;}
    .pdoc-iv{font-size:9.5pt;font-weight:600;}
    .pdoc-glbl{font-size:7.5pt;font-weight:bold;text-transform:uppercase;padding:3pt 8pt;margin:6pt 0 5pt;display:inline-block;}
    .gl-w{background:#F7EFD8;color:#8A6A1A;} .gl-t{background:#E6F2EC;color:#3A7A5C;}
    .pdoc-mod{border:1pt solid #DDD6CE;margin-bottom:8pt;page-break-inside:avoid;width:100%;}
    .pdoc-mhd{background:#F8F5F0;padding:6pt 8pt;border-bottom:1pt solid #DDD6CE;}
    .pdoc-mnum{font-size:7pt;font-weight:bold;color:#C8622A;background:#F5E6DB;padding:1pt 4pt;margin-right:5pt;}
    .pdoc-mname{font-size:9.5pt;font-weight:bold;}
    .pdoc-mpri{font-size:7pt;font-weight:bold;padding:1pt 5pt;float:right;}
    .pm-w{background:#F7EFD8;color:#8A6A1A;} .pm-t{background:#E6F2EC;color:#3A7A5C;}
    .pdoc-mbody{padding:6pt 8pt;}
    .pdoc-f{margin-bottom:6pt;}
    .pdoc-fl{font-size:7pt;font-weight:bold;text-transform:uppercase;color:#8A7A66;border-bottom:1pt solid #EEE8DF;padding-bottom:1pt;margin-bottom:2pt;letter-spacing:.5px;}
    .pdoc-fv{font-size:9pt;color:#2A2015;white-space:pre-wrap;}
    .pdoc-2c{display:table;width:100%;border-collapse:collapse;}
    .pdoc-2c>div{display:table-cell;width:50%;padding-right:8pt;vertical-align:top;}
    .pdoc-notes{background:#FFF8F5;border:1pt solid #F0D5C5;padding:6pt 8pt;margin-top:8pt;}
    .pdoc-nl{font-size:7pt;font-weight:bold;text-transform:uppercase;color:#C8622A;margin-bottom:3pt;}
    .pdoc-nv{font-size:9pt;white-space:pre-wrap;}
    .pdoc-ftr{border-top:1pt solid #E2D9CC;margin-top:10pt;padding-top:5pt;font-size:7.5pt;color:#8A7A66;}
    .pdoc-imgs{margin-top:4pt;} .pdoc-img-wrap{display:inline-block;margin-right:6pt;text-align:center;vertical-align:top;}
    .pdoc-img-cap{font-size:7pt;color:#8A7A66;display:block;}
  `;

  const html=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head>
<meta charset="UTF-8">
<meta name="ProgId" content="Word.Document">
<meta name="Generator" content="Microsoft Word 15">
<title>${esc(app)}</title>
<!--[if gte mso 9]><xml><w:WordDocument><w:View>Print</w:View><w:Zoom>90</w:Zoom><w:DoNotOptimizeForBrowser/></w:WordDocument></xml><![endif]-->
<style>${wordStyles}</style>
</head>
<body>${buildDoc()}</body>
</html>`;

  const blob=new Blob(['\ufeff'+html],{type:'application/msword'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=`Kebutuhan_Modul_${app.replace(/[^a-zA-Z0-9]/g,'_')}.doc`;
  a.click();
  setTimeout(()=>URL.revokeObjectURL(url),2000);
  toast('File Word berhasil diunduh âœ“','ok');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPORT HTML
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function exportHTML(){
  if(!mods.length){toast('Belum ada modul!','err');return;}
  $('export-menu').classList.remove('open');
  const app=val('app-name')||'Dokumen';

  const docStyles=Array.from(document.styleSheets)
    .flatMap(ss=>{try{return Array.from(ss.cssRules).map(r=>r.cssText);}catch(e){return [];}})
    .join('\n');

  const html=`<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>${esc(app)} â€” Kebutuhan Modul</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
${docStyles}
body{background:#F0EDE8;padding:24px 16px 48px;min-height:100vh;}
.pdoc{max-width:820px;margin:0 auto;box-shadow:0 8px 32px rgba(0,0,0,.12);border-radius:8px;overflow:hidden;}
</style>
</head>
<body>${buildDoc()}</body>
</html>`;

  const blob=new Blob([html],{type:'text/html;charset=utf-8'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=`Kebutuhan_Modul_${app.replace(/[^a-zA-Z0-9]/g,'_')}.html`;
  a.click();
  setTimeout(()=>URL.revokeObjectURL(url),2000);
  toast('File HTML berhasil diunduh âœ“','ok');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOBILE NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setMobActive(id){document.querySelectorAll('.mnb').forEach(b=>b.classList.remove('active'));if(id)$(id)?.classList.add('active');}
function mobModules(){openSidebar();setMobActive('mnav-modules');}
function mobForm(){closeSidebar();$('pv-panel').classList.remove('mob-modal','open');pvOpen=false;setMobActive('mnav-form');}
function mobPreview(){
  setMobActive('mnav-preview');pvOpen=true;
  $('pv-panel').classList.add('open','mob-modal');
  renderPreview();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MISC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updatePri(){const s=$('mod-pri');s.className=s.value==='Wajib Ada'?'pw':'pt';}
function confirmReset(){
  if(!confirm('Reset semua data?'))return;
  localStorage.removeItem(SK);
  setv('app-name','');setv('target-user','');setv('extra-notes','');
  mods=[];editId=null;clearForm();renderSb();schedPreview();
  toast('Semua data direset.','err');
}
function toast(msg,type='ok'){
  const c=$('toasts'),el=document.createElement('div');
  el.className=`toast ${type}`;
  el.innerHTML=`<span>${type==='ok'?'âœ“':'âœ•'}</span>${msg}`;
  c.appendChild(el);setTimeout(()=>el.remove(),3400);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXAMPLE DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function loadExample(){
  setv('app-name','Sistem Informasi Pesantren');
  setv('target-user','Admin Pesantren, Ustadz, Wali Santri');
  setv('extra-notes','Tema warna hijau pesantren (#1E6B47). Integrasi printer thermal untuk cetak kartu santri. Referensi: pesantren.id/dashboard. Mobile-first responsive.');
  mods=[
    {id:'e1',name:'Modul Pengisian Data Santri',pri:'Wajib Ada',
     desc:'Memungkinkan admin pesantren mendaftarkan santri baru secara digital, mengisi biodata lengkap, mengunggah foto, dan menetapkan kelas serta kamar. Menggantikan form kertas manual.',
     inp:'- Nama lengkap santri\n- Tempat & tanggal lahir\n- NIK (Nomor Induk Kependudukan)\n- Alamat asal (Provinsi, Kota, Kecamatan, RT/RW)\n- Nama & nomor HP wali santri\n- Pendidikan terakhir\n- Foto santri (JPG/PNG, maks 2MB)\n- Kelas yang dituju\n- Nomor kamar asrama',
     proc:'- Sistem otomatis membuat NIS unik: PS-[TAHUN]-[URUTAN]\n- Validasi: NIK tidak boleh duplikat\n- Validasi: Format nomor HP wali (08xx)\n- Foto otomatis di-resize ke 300x400px\n- Status santri default = "Aktif"',
     out:'- Data santri tersimpan di database\n- NIS unik terbuat otomatis\n- Daftar santri admin terupdate',imgs:[]},
    {id:'e2',name:'Modul Absensi Santri',pri:'Wajib Ada',
     desc:'Mencatat kehadiran santri pada setiap sesi kegiatan dan menghasilkan laporan rekapitulasi bulanan untuk wali dan pimpinan pesantren.',
     inp:'- Pilih tanggal & sesi kegiatan\n- Pilih kelas\n- Status tiap santri: Hadir / Izin / Sakit / Alfa\n- Keterangan (opsional)',
     proc:'- Alfa >3x seminggu â†’ flag peringatan otomatis\n- Rekapitulasi bulanan dihitung otomatis (% kehadiran)\n- Kehadiran <75% â†’ status merah di dashboard',
     out:'- Data absensi tersimpan per sesi\n- Dashboard absensi real-time per kelas\n- Laporan PDF rekapitulasi bulanan\n- Flag peringatan santri bermasalah',imgs:[]},
    {id:'e3',name:'Modul Pembayaran SPP',pri:'Wajib Ada',
     desc:'Mengelola tagihan dan pembayaran SPP bulanan serta menghasilkan kuitansi resmi. Bendahara dapat melihat laporan keuangan real-time.',
     inp:'- Pilih nama santri / NIS\n- Bulan & tahun tagihan\n- Jumlah pembayaran\n- Metode bayar: Tunai / Transfer\n- Foto bukti transfer (jika transfer)',
     proc:'- Total tagihan = SPP Pokok + Biaya Makan + Biaya Listrik\n- Cek tunggakan bulan sebelumnya otomatis\n- Status "Lunas" otomatis setelah input\n- Laporan masuk ke dashboard bendahara',
     out:'- Kuitansi PDF (cetak thermal)\n- Status: Lunas / Belum Lunas / Menunggak\n- Laporan pemasukan harian & bulanan\n- Reminder WhatsApp tanggal 5 tiap bulan',imgs:[]},
    {id:'e4',name:'Modul Nilai & Rapor',pri:'Tambahan Saja',
     desc:'Ustadz memasukkan nilai ujian, nilai harian, dan nilai hafalan. Sistem otomatis menghitung nilai akhir dan menghasilkan rapor digital.',
     inp:'- Pilih kelas & mata pelajaran\n- Pilih periode (semester)\n- Nilai harian (0â€“100)\n- Nilai UTS\n- Nilai UAS\n- Nilai hafalan (halaman/juz)',
     proc:'- Nilai Akhir = (HarianÃ—30%) + (UTSÃ—30%) + (UASÃ—40%)\n- Predikat: A(â‰¥90), B(75â€“89), C(60â€“74), D(<60)\n- Ranking kelas otomatis dari rata-rata semua mapel',
     out:'- Rapor digital PDF diunduh wali via portal\n- Dashboard ranking kelas untuk ustadz',imgs:[]}
  ];
  saveProj();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded',()=>{
  loadProj();
  renderSb();
  updatePri();
});
</script>
</body>
</html>
